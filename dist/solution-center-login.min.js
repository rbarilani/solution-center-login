/*!
 * solution-center-login
 * https://github.com/zalando-incubator/solution-center-login
 * License: MIT
 */
function authenticationFactory(n,t,e,o,r,i,a,u){"use strict";function c(){return O.authenticate(encodeURIComponent(r.location.href))}function s(){return O.isAuthenticated()?(S(),n.reject()):n.when()}function l(t){var e=O.getToken();return p(e).then(function(){return v(e)},function(o){if(304===o.status)return v(e);if(409===o.status){var r=o.data;return v(r)}return k(),O.redirectToLogin(t),n.reject()})}function g(n){var t=o.getLoginPath();E(n)&&(t+="?redirect="+n),S(t)}function f(){k();var n=o.getLogoutPath();S(n)}function m(){return t.token||e.get(N)}function d(){return null!==O.getUser()}function h(){return t.user}function v(e){return t.token=e,t.user=T(e),n.when(e)}function k(){t.token=null,t.user=null}function p(t){return t?i.get("$http").get(o.getTokensAPI(L.getEnvironment()),t):n.reject("There is no token")}function T(n){return a.decodeToken(n)}function E(n){var t=o.getDomain(L.getEnvironment());return-1!==n.indexOf(t)}function S(n){n=n||"/",L.isInternalCommunication()?u.url(n):r.location.href=o.getSolutionCenterUrl(L.getEnvironment())+"/#"+n}var L=this,N="SC_TOKEN",O={requireAuthenticatedUser:c,redirectToHomeIfAuthenticated:s,authenticate:l,redirectToLogin:g,getToken:m,logout:f,isAuthenticated:d,getUser:h};return O}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).config(["$localStorageProvider",function(n){n.setKeyPrefix("solutionCenter-")}]).provider("authenticationService",["ENVIRONMENTS",function(n){"use strict";var t,e="LOCAL",o=!1,r=function(t){return!!n[t]};return{configEnvironment:function(o,i,a){t={},t.name=r(o)?o:e,t.name===e&&(t.port=i||n[e].port,t.tokenService=a||n[e].tokenservice)},getEnvironment:function(){return t||(t={name:e,port:n[e].port,tokenService:n[e].tokenservice}),t},setInternalCommunication:function(n){o=n},isInternalCommunication:function(){return o},$get:["$q","$localStorage","$cookies","environmentsService","$window","$injector","jwtHelper","$location",authenticationFactory]}}]),angular.module("sc-authentication").constant("ENVIRONMENTS",{PRODUCTION:{url:"https://www.solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do",domain:"solutions.zalando.com"},INTEGRATION:{url:"https://usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do",domain:".zalan.do"},STAGING:{url:"https://usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do",domain:".zalan.do"},DEVELOPMENT:{url:"https://usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:".zalan.do"},LOCAL:{url:"http://localhost:{PORT}",port:3e3,tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:"localhost"}}),angular.module("sc-authentication").factory("environmentsService",["ENVIRONMENTS",function(n){function t(t){var e=n[t.name].url;return"LOCAL"===t.name&&(e=e.replace("{PORT}",t.port)),e}function e(){return"/login"}function o(){return"/logout"}function r(t){return"LOCAL"===t.name?t.tokenService+"/tokens":n[t.name].tokenservice+"/tokens"}function i(t){return n[t.name].domain}return{getSolutionCenterUrl:t,getLoginPath:e,getLogoutPath:o,getTokensAPI:r,getDomain:i}}]);