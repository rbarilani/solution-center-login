/*!
 * solution-center-login
 * https://github.com/zalando-incubator/solution-center-login
 * License: MIT
 */
<<<<<<< HEAD
function authenticationFactory(n,t,e,r,o,i,a,u,c){"use strict";function s(){return M.authenticate(encodeURIComponent(o.location.href))}function l(){return M.isAuthenticated()?(U(),n.reject()):n.when()}function g(t){var e=M.getToken();return P(e).then(function(){return w(e)},function(r){if(304===r.status)return w(e);if(409===r.status){var o=r.data;return w(o)}return M.clearCredentials(),S(t),n.reject()})}function d(t,e){return i.get("$http").post(r.getTokensAPI(B.getEnvironment()),{email:t,password:e,userAgent:y()}).then(function(t){return M.setToken(t.data),n.when(t.data)},function(){return n.reject("Wrong credentials")})}function f(t,e){return M.login(t,e).then(function(t){return w(t),n.when()},function(){return n.reject()})}function m(){return $(v())["catch"](function(){})["finally"](function(){return M.clearCredentials(),U(r.getLoginPath()),n.when()})}function h(){return $(v())["catch"](function(){})["finally"](function(){return M.clearCredentials(),n.when()})}function v(){return t.token||e.get(D)}function p(n){t.token=n,e.put(D,n)}function k(){return!!M.getUser()}function T(){return t.user}function z(){return t.brand||e.get(b)}function A(n){L(n)}function C(){N(),O(),M.clearBrand()}function E(){t.brand=null,e.remove(b)}function S(n){var t=r.getLoginPath();R(n)&&(t+="?redirect="+n),U(t)}function w(t){return M.setToken(t),I(j(t)),n.when(t)}function I(n){t.user=n}function L(n){t.brand=n,e.put(b,n)}function N(){t.token=null,e.remove(D)}function O(){t.user=null}function P(t){if(!t)return n.reject("There is no token");var e=j(t);return e&&e.userAgent!==y()?n.reject("The current browser doesn't match the one stored in the token"):i.get("$http").get(r.getTokensAPI(B.getEnvironment()),t)}function $(n){return i.get("$http")["delete"](r.getTokensAPI(B.getEnvironment()),{headers:{Authorization:n}})}function j(n){return a.decodeToken(n)}function R(n){var t=r.getDomain(B.getEnvironment());return!!n&&-1!==n.indexOf(t)}function U(n){n=n||"/",B.isInternalCommunication()?c(function(){u.url(n)}):o.location.href=r.getSolutionCenterUrl(B.getEnvironment())+"/#"+n}function y(){return o.navigator.userAgent}var B=this,D="SC_TOKEN",b="SC_BRAND",M={requireAuthenticatedUser:s,redirectToHomeIfAuthenticated:l,authenticate:g,login:d,silentLogin:f,logout:m,silentLogout:h,getToken:v,setToken:p,isAuthenticated:k,getUser:T,getBrand:z,changeBrand:A,clearCredentials:C,clearBrand:E};return M}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).config(["$localStorageProvider",function(n){n.setKeyPrefix("solutionCenter-")}]).provider("authenticationService",["ENVIRONMENTS",function(n){"use strict";var t,e="LOCAL",r=!1,o=function(t){return!!n[t]};return{configEnvironment:function(r,i,a){t={},t.name=o(r)?r:e,t.name===e&&(t.port=i||n[e].port,t.tokenService=a||n[e].tokenservice)},getEnvironment:function(){return t||(t={name:e,port:n[e].port,tokenService:n[e].tokenservice}),t},setInternalCommunication:function(n){r=n},isInternalCommunication:function(){return r},$get:["$q","$localStorage","$cookies","environmentsService","$window","$injector","jwtHelper","$location","$timeout",authenticationFactory]}}]),angular.module("sc-authentication").constant("ENVIRONMENTS",{PRODUCTION:{url:"https://www.solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do",userservice:"https://user-management.norris.zalan.do",domain:"solutions.zalando.com"},STAGE:{url:"https://sc-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do",userservice:"https://um-stage.norris.zalan.do",domain:".zalan.do"},INTEGRATION:{url:"https://sc-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do",userservice:"https://um-integration.norris.zalan.do",domain:".zalan.do"},DEVELOPMENT:{url:"https://sc-development.norris.zalan.do",tokenservice:"https://tm-development.norris.zalan.do",userservice:"https://um-development.norris.zalan.do",domain:".zalan.do"},LOCAL:{url:"http://localhost:{PORT}",port:3333,tokenservice:"https://tm-development.norris.zalan.do",userservice:"https://um-development.norris.zalan.do",domain:"localhost"}}),angular.module("sc-authentication").factory("environmentsService",["ENVIRONMENTS",function(n){function t(t){var e=n[t.name].url;return"LOCAL"===t.name&&(e=e.replace("{PORT}",t.port)),e}function e(){return"/login"}function r(){return"/logout"}function o(t){return"LOCAL"===t.name?t.tokenService+"/tokens":n[t.name].tokenservice+"/tokens"}function i(t){return n[t.name].domain}return{getSolutionCenterUrl:t,getLoginPath:e,getLogoutPath:r,getTokensAPI:o,getDomain:i}}]);
=======
function authenticationFactory(n,t,e,o,r,i,a,u,c){"use strict";function s(){return B.authenticate(encodeURIComponent(r.location.href))}function l(){return B.isAuthenticated()?(j(),n.reject()):n.when()}function g(t){var e=B.getToken();return w(e).then(function(){return I(e)},function(o){if(304===o.status)return I(e);if(409===o.status){var r=o.data;return I(r)}return B.clearCredentials(),A(t),n.reject()})}function m(t,e){return i.get("$http").post(o.getTokensAPI(D.getEnvironment()),{email:t,password:e}).then(function(t){return B.setToken(t.data),n.when(t.data)},function(){return n.reject("Wrong credentials")})}function d(t,e){return B.login(t,e).then(function(t){return I(t),n.when()},function(){return n.reject()})}function f(){return P(v())["catch"](function(){})["finally"](function(){return B.clearCredentials(),j(o.getLoginPath()),n.when()})}function h(){return P(v())["catch"](function(){})["finally"](function(){return B.clearCredentials(),n.when()})}function v(){return e.get(U)}function p(n){e.put(U,n,{domain:o.getDomain(D.getEnvironment())})}function k(){return!!B.getUser()}function T(){return t.user}function E(){return e.get(y)}function z(n){e.put(y,n,{domain:o.getDomain(D.getEnvironment())})}function C(){N(),O(),B.clearBrand()}function S(){e.remove(y)}function A(n){var t=o.getLoginPath();R(n)&&(t+="?redirect="+n),j(t)}function I(t){return B.setToken(t),L($(t)),n.when(t)}function L(n){t.user=n}function N(){e.remove(U)}function O(){t.user=null}function w(t){return t?i.get("$http").get(o.getTokensAPI(D.getEnvironment()),t):n.reject("There is no token")}function P(n){return i.get("$http")["delete"](o.getTokensAPI(D.getEnvironment()),{headers:{Authorization:n}})}function $(n){return a.decodeToken(n)}function R(n){var t=o.getDomain(D.getEnvironment());return!!n&&-1!==n.indexOf(t)}function j(n){n=n||"/",D.isInternalCommunication()?c(function(){u.url(n)}):r.location.href=o.getSolutionCenterUrl(D.getEnvironment())+"/#"+n}var D=this,U="SC_TOKEN",y="SC_BRAND",B={requireAuthenticatedUser:s,redirectToHomeIfAuthenticated:l,authenticate:g,login:m,silentLogin:d,logout:f,silentLogout:h,getToken:v,setToken:p,isAuthenticated:k,getUser:T,getBrand:E,setBrand:z,clearCredentials:C,clearBrand:S};return B}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).config(["$localStorageProvider",function(n){n.setKeyPrefix("solutionCenter-")}]).provider("authenticationService",["ENVIRONMENTS",function(n){"use strict";var t,e="LOCAL",o=!1,r=function(t){return!!n[t]};return{configEnvironment:function(o,i,a){t={},t.name=r(o)?o:e,t.name===e&&(t.port=i||n[e].port,t.tokenService=a||n[e].tokenservice)},getEnvironment:function(){return t||(t={name:e,port:n[e].port,tokenService:n[e].tokenservice}),t},setInternalCommunication:function(n){o=n},isInternalCommunication:function(){return o},$get:["$q","$localStorage","$cookies","environmentsService","$window","$injector","jwtHelper","$location","$timeout",authenticationFactory]}}]),angular.module("sc-authentication").constant("ENVIRONMENTS",{PRODUCTION:{url:"https://www.solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do",userservice:"https://user-management.norris.zalan.do",domain:"solutions.zalando.com"},STAGE:{url:"https://sc-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do",userservice:"https://um-stage.norris.zalan.do",domain:".zalan.do"},INTEGRATION:{url:"https://sc-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do",userservice:"https://um-integration.norris.zalan.do",domain:".zalan.do"},DEVELOPMENT:{url:"https://sc-development.norris.zalan.do",tokenservice:"https://tm-development.norris.zalan.do",userservice:"https://um-development.norris.zalan.do",domain:".zalan.do"},LOCAL:{url:"http://localhost:{PORT}",port:3333,tokenservice:"https://tm-development.norris.zalan.do",userservice:"https://um-development.norris.zalan.do",domain:"localhost"}}),angular.module("sc-authentication").factory("environmentsService",["ENVIRONMENTS",function(n){function t(t){var e=n[t.name].url;return"LOCAL"===t.name&&(e=e.replace("{PORT}",t.port)),e}function e(){return"/login"}function o(){return"/logout"}function r(t){return"LOCAL"===t.name?t.tokenService+"/tokens":n[t.name].tokenservice+"/tokens"}function i(t){return n[t.name].domain}return{getSolutionCenterUrl:t,getLoginPath:e,getLogoutPath:o,getTokensAPI:r,getDomain:i}}]);
>>>>>>> master
