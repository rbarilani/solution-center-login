/*!
 * solution-center-login
 * https://github.com/zalando/solution-center-login
 * License: MIT
 */
function authenticationFactory(t,n,e,r,o,i,a,u){"use strict";function c(){return s(o.location.href)}function s(n){var e=v();return d(e).then(function(){return l(e)},function(r){if(304===r.status)return l(e);if(409===r.status){var o=r.data;return l(o)}return g(n),t.reject()})}function l(e){return n.sc_token=e,n.sc_user=m(e),t.when(e)}function g(t){var n=r.getLoginPath()+"?redirect="+t;k(n)}function f(){n.sc_token=null,n.sc_user=null;var t=r.getLogoutPath();k(t)}function v(){return n.sc_token||e.get(p)}function h(){return n.sc_user}function d(n){return n?i.get("$http").get(r.getTokensAPI(T.getEnvironment()),n):t.reject("There is no token")}function m(t){return a.decodeToken(t)}function k(t){t=t||"/";var n=r.getDomain(T.getEnvironment());o.location.host===n?u.url(t):o.location.href=n+"/#"+t}var T=this,p="SC_TOKEN";return{authenticate:s,redirectToLogin:g,getToken:v,logout:f,getUser:h,requireAuthenticatedUser:c}}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).provider("authenticationService",[function(){"use strict";var t={name:"LOCAL",port:"3000"};return{configEnvironment:function(n,e){t.name=n,e&&(t.port=e)},getEnvironment:function(){return t},$get:["$q","$localStorage","$cookies","environments","$window","$injector","jwtHelper","$location",authenticationFactory]}}]),angular.module("sc-authentication").factory("environments",[function(){function t(t){var n=o[t.name].url;return"LOCAL"===t.name&&(n=n.replace("{PORT}",t.port)),n}function n(){return"/login"}function e(){return"/logout"}function r(t){return o[t.name].tokenservice+"/tokens"}var o={PRODUCTION:{url:"solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do"},INTEGRATION:{url:"usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do"},STAGING:{url:"usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do"},DEVELOPMENT:{url:"usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do"},LOCAL:{url:"localhost:{PORT}",tokenservice:"https://tm-dev-ext.norris.zalan.do"}};return{getDomain:t,getLoginPath:n,getLogoutPath:e,getTokensAPI:r}}]);