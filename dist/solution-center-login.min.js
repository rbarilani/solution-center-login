/*!
 * solution-center-login
 * https://github.com/zalando-incubator/solution-center-login
 * License: MIT
 */
function authenticationFactory(n,t,e,o,r,i,u,a){"use strict";function c(){return A.authenticate(encodeURIComponent(r.location.href))}function s(){return A.isAuthenticated()?(z(),n.reject()):n.when()}function l(t){var e=A.getToken();return T(e).then(function(){return v(e)},function(o){if(304===o.status)return v(e);if(409===o.status){var r=o.data;return v(r)}return k(),A.redirectToLogin(t),n.reject()})}function g(n){var t=o.getLoginPath();p(n)&&(t+="?redirect="+n),z(t)}function d(){k();var n=o.getLogoutPath();z(n)}function f(){return t.sc_token||e.get(S)}function m(){return null!==A.getUser()}function h(){return t.sc_user}function v(e){return t.sc_token=e,t.sc_user=C(e),n.when(e)}function k(){t.sc_token=null,t.sc_user=null}function T(t){return t?i.get("$http").get(o.getTokensAPI(L.getEnvironment()),t):n.reject("There is no token")}function C(n){return u.decodeToken(n)}function p(n){var t=o.getDomain(L.getEnvironment());return-1!==n.indexOf(t)}function z(n){n=n||"/",L.isSolutionCenterCommunication()?a.url(n):r.location.href=o.getSolutionCenterUrl(L.getEnvironment())+"/#"+n}var L=this,S="SC_TOKEN",A={requireAuthenticatedUser:c,redirectToHomeIfAuthenticated:s,authenticate:l,redirectToLogin:g,getToken:f,logout:d,isAuthenticated:m,getUser:h};return A}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).provider("authenticationService",[function(){"use strict";var n={name:"LOCAL",port:"3000"},t=!1;return{configEnvironment:function(t,e){n.name=t,n.port=e||n.port},getEnvironment:function(){return n},setSolutionCenterCommunication:function(n){t=n},isSolutionCenterCommunication:function(){return t},$get:["$q","$localStorage","$cookies","environmentsService","$window","$injector","jwtHelper","$location",authenticationFactory]}}]),angular.module("sc-authentication").factory("environmentsService",[function(){function n(n){var t=i[n.name].url;return"LOCAL"===n.name&&(t=t.replace("{PORT}",n.port)),t}function t(){return"/login"}function e(){return"/logout"}function o(n){return i[n.name].tokenservice+"/tokens"}function r(n){return i[n.name].domain}var i={PRODUCTION:{url:"solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do",domain:"solutions.zalando.com"},INTEGRATION:{url:"usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do",domain:".zalan.do"},STAGING:{url:"usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do",domain:".zalan.do"},DEVELOPMENT:{url:"usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:".zalan.do"},LOCAL:{url:"localhost:{PORT}",tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:"localhost"}};return{getSolutionCenterUrl:n,getLoginPath:t,getLogoutPath:e,getTokensAPI:o,getDomain:r}}]);