/*!
 * solution-center-login
 * https://github.com/zalando/solution-center-login
 * License: MIT
 */
angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).factory("authenticationService",["$q","$localStorage","$cookies","environments","$window","$injector","jwtHelper",function(n,t,e,r,o,i,u){"use strict";function a(n,e){f(n).then(function(n){return t.sc_token=n,t.sc_user=d(n),n},function(){c(n,e)})}function c(n,t){o.location.href=r.getLoginUrl(n)+"?redirect="+encodeURIComponent(t)}function s(n){t.sc_token=null,t.sc_user=null,o.location.href=r.getLogoutUrl(n)}function l(){return t.sc_token||e.get(v)}function g(){return t.sc_user}function f(t){var e=l();return h(e,t).then(function(){return n.when(e)},function(t){if(304===t.status)return n.when(e);if(409===t.status){var r=t.data;return n.when(r)}return n.reject()})}function h(t,e){return t?i.get("$http").get(r.getTokensAPI(e),t):n.reject("null token")}function d(n){return u.decodeToken(n)}var v="SC_TOKEN";return{authenticate:a,redirectToLogin:c,getToken:l,logout:s,getUser:g}}]),angular.module("sc-authentication").provider("authorizationService",[function(){"use strict";var n={name:"LOCAL",port:"3000"};this.configEnvironment=function(t,e){n.name=t,e&&(n.port=e)},this.$get=["$q","authenticationService","$window",function(t,e,r){var o={requireAuthenticatedUser:function(){var o=e.getUser();return o?t.when(o):(e.authenticate(n,r.location.href),t.reject())}};return o}]}]),angular.module("sc-authentication").factory("environments",[function(){function n(n){var t=o[n.name].url;return"LOCAL"===n.name&&(t=t.replace("{PORT}",n.port)),t}function t(t){return n(t)+"/#/login"}function e(t){return n(t)+"/#/logout"}function r(n){return o[n].tokenservice+"/tokens"}var o={PRODUCTION:{url:"solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do"},INTEGRATION:{url:"usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do"},STAGING:{url:"usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do"},DEVELOPMENT:{url:"usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do"},LOCAL:{url:"localhost:{PORT}",tokenservice:"https://tm-dev-ext.norris.zalan.do"}};return{getLoginUrl:t,getLogoutUrl:e,getTokensAPI:r}}]);