/*!
 * solution-center-login
 * https://github.com/zalando/solution-center-login
 * License: MIT
 */
angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).factory("authenticationService",["$q","$localStorage","$cookies","environments","$window","$injector","jwtHelper","$location",function(t,n,e,o,r,i,a,u){"use strict";function c(e,o){return h(g(),e).then(function(){return n.sc_token=token,n.sc_user=k(token),t.when(token)},function(r){if(304===r.status)return n.sc_token=token,n.sc_user=k(token),t.when(token);if(409===r.status){var i=r.data;return n.sc_token=i,n.sc_user=k(i),t.when(i)}return s(e,o),t.reject()})}function s(t,n){var e=o.getDomain(t),i=o.getLoginPath()+"?redirect="+n;r.location.host===e?u.url(i):r.location.href=e+"/#"+i}function l(t){n.sc_token=null,n.sc_user=null,r.location.href=o.getLogoutUrl(t)}function g(){return n.sc_token||e.get(d)}function f(){return n.sc_user}function h(n,e){return n?i.get("$http").get(o.getTokensAPI(e),n):t.reject("null token")}function k(t){return a.decodeToken(t)}var d="SC_TOKEN";return{authenticate:c,redirectToLogin:s,getToken:g,logout:l,getUser:f}}]),angular.module("sc-authentication").provider("authorizationService",[function(){"use strict";var t={name:"LOCAL",port:"3000"};this.configEnvironment=function(n,e){t.name=n,e&&(t.port=e)},this.$get=["$q","authenticationService","$window",function(n,e,o){var r={requireAuthenticatedUser:function(){return e.authenticate(t,o.location.href)}};return r}]}]),angular.module("sc-authentication").factory("environments",[function(){function t(t){var n=r[t.name].url;return"LOCAL"===t.name&&(n=n.replace("{PORT}",t.port)),n}function n(){return"/login"}function e(){return"/logout"}function o(t){return r[t].tokenservice+"/tokens"}var r={PRODUCTION:{url:"solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do"},INTEGRATION:{url:"usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do"},STAGING:{url:"usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do"},DEVELOPMENT:{url:"usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do"},LOCAL:{url:"localhost:{PORT}",tokenservice:"https://tm-dev-ext.norris.zalan.do"}};return{getDomain:t,getLoginPath:n,getLogoutPath:e,getTokensAPI:o}}]);