/*!
 * solution-center-login
 * https://github.com/zalando-incubator/solution-center-login
 * License: MIT
 */
function authenticationFactory(t,n,e,o,r,i,a,u){"use strict";function c(){return A.authenticate(encodeURIComponent(r.location.href))}function s(){return A.isAuthenticated()?(z(),t.reject()):t.when()}function l(n){var e=A.getToken();return p(e).then(function(){return v(e)},function(o){if(304===o.status)return v(e);if(409===o.status){var r=o.data;return v(r)}return k(),A.redirectToLogin(n),t.reject()})}function g(t){var n=o.getLoginPath();L(t)&&(n+="?redirect="+t),z(n)}function d(){k();var t=o.getLogoutPath();z(t)}function m(){return n.sc_token||e.get(S)}function f(){return null!==A.getUser()}function h(){return n.sc_user}function v(e){return n.sc_token=e,n.sc_user=T(e),t.when(e)}function k(){n.sc_token=null,n.sc_user=null}function p(n){return n?i.get("$http").get(o.getTokensAPI(C.getEnvironment()),n):t.reject("There is no token")}function T(t){return a.decodeToken(t)}function L(t){var n=o.getDomain(C.getEnvironment());return-1!==t.indexOf(n)}function z(t){t=t||"/",C.isInternalCommunication()?u.url(t):r.location.href=o.getSolutionCenterUrl(C.getEnvironment())+"/#"+t}var C=this,S="SC_TOKEN",A={requireAuthenticatedUser:c,redirectToHomeIfAuthenticated:s,authenticate:l,redirectToLogin:g,getToken:m,logout:d,isAuthenticated:f,getUser:h};return A}angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).provider("authenticationService",[function(){"use strict";var t={name:"LOCAL",port:"3000",tokenService:"https://tm-dev-ext.norris.zalan.do"},n=!1;return{configEnvironment:function(n,e,o){t.name=n,t.port=e||t.port,t.tokenService=o||t.tokenService},getEnvironment:function(){return t},setInternalCommunication:function(t){n=t},isInternalCommunication:function(){return n},$get:["$q","$localStorage","$cookies","environmentsService","$window","$injector","jwtHelper","$location",authenticationFactory]}}]),angular.module("sc-authentication").factory("environmentsService",[function(){function t(t){var n=i[t.name].url;return"LOCAL"===t.name&&(n=n.replace("{PORT}",t.port?t.port:i[t.name].defaultPort)),n}function n(){return"/login"}function e(){return"/logout"}function o(t){return"LOCAL"===t.name?t.tokenService+"/tokens":i[t.name].tokenservice+"/tokens"}function r(t){return i[t.name].domain}var i={PRODUCTION:{url:"https://www.solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do",domain:"solutions.zalando.com"},INTEGRATION:{url:"https://usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do",domain:".zalan.do"},STAGING:{url:"https://usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do",domain:".zalan.do"},DEVELOPMENT:{url:"https://usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:".zalan.do"},LOCAL:{url:"http://localhost:{PORT}",tokenservice:"https://tm-dev-ext.norris.zalan.do",domain:"localhost"}};return{getSolutionCenterUrl:t,getLoginPath:n,getLogoutPath:e,getTokensAPI:o,getDomain:r}}]);