/*!
 * solution-center-login
 * https://github.com/zalando/solution-center-login
 * License: MIT
 */
angular.module("sc-authentication",["ngStorage","ngCookies","angular-jwt"]).factory("authenticationService",["$q","$localStorage","$cookies","environments","$location","$injector","jwtHelper",function(t,n,e,r,o,u,i){"use strict";function a(t,e){f().then(function(t){return n.sc_token=t,n.sc_user=v(t),t},function(){c(t,e)})}function c(t,n){o.url(r.getLoginUrl(t)+"?redirect="+n)}function s(t){n.sc_token=null,n.sc_user=null,o.url(r.getLogoutUrl(t))}function l(){return n.sc_token||e.get(d)}function g(){return n.sc_user}function f(){var n=l();return h(n).then(function(){return t.when(n)},function(e){if(304===e.status)return t.when(n);if(409===e.status){var r=e.data;return t.when(r)}return t.reject()})}function h(n){return n?u.get("$http").get(r.getTokensAPI(),n):t.reject("null token")}function v(t){return i.decodeToken(t)}var d="SC_TOKEN";return{authenticate:a,redirectToLogin:c,getToken:l,logout:s,getUser:g}}]),angular.module("sc-authentication").provider("authorizationService",[function(){"use strict";var t="STAGE";this.setEnvironment=function(n){t=n},this.$get=["$q","authenticationService","$location",function(n,e,r){var o={requireAuthenticatedUser:function(){var o=e.getUser();return o?n.when(o):(e.authenticate(t,r.url()),n.reject())}};return o}]}]),angular.module("sc-authentication").factory("environments",[function(){function t(t){return o[t].url}function n(n){return t(n)+"/#/login"}function e(n){return t(n)+"/#/logout"}function r(t){return o[t].tokenservice+"/tokens"}var o={PRODUCTION:{url:"solutions.zalando.com",tokenservice:"https://token-management.norris.zalan.do"},INTEGRATION:{url:"usf-integration.norris.zalan.do",tokenservice:"https://tm-integration.norris.zalan.do"},STAGING:{url:"usf-stage.norris.zalan.do",tokenservice:"https://tm-stage.norris.zalan.do"},DEVELOPMENT:{url:"usf-dev.norris.zalan.do",tokenservice:"https://tm-dev-ext.norris.zalan.do"},LOCAL:{url:"localhost",tokenservice:"https://tm-dev-ext.norris.zalan.do"}};return{getLoginUrl:n,getLogoutUrl:e,getTokensAPI:r}}]);